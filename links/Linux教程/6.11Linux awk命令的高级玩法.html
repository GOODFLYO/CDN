<!DOCTYPE html>
<!-- saved from url=(0041)http://c.biancheng.net/view/vip_5064.html -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" async="" charset="utf-8" src="./6.11Linux awk命令的高级玩法_files/core.php"></script><script async="" src="./6.11Linux awk命令的高级玩法_files/click.php"></script>

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
<!-- 启用Chromium高速渲染模式 -->
<meta name="renderer" content="webkit">
<meta name="force-rendering" content="webkit">
<!-- 禁止百度转码 -->
<meta name="applicable-device" content="pc,mobile">
<meta name="MobileOptimized" content="width">
<meta name="HandheldFriendly" content="true">
<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
<!-- 禁止识别电话号码 -->
<meta name="format-detection" content="telephone=no">

<link rel="shortcut icon" href="http://c.biancheng.net/favicon.ico?v=1.6.72">
<link href="./6.11Linux awk命令的高级玩法_files/common.css" rel="stylesheet">
<title>Linux awk命令的高级玩法</title>
<meta name="description" content="前面一节已经介绍了 awk 的基本用法，其实在 awk 脚本程序中，还支持使用一些编程语言，比如变量、数组、分支结构（if-then-else）、循环结构（while）、函数等，下面一一给大家介绍。">
</head>
<body>
<div id="topbar" class="clearfix">
	<ul id="product-type" class="left">
		<li>
			<a href="http://c.biancheng.net/"><span class="iconfont iconfont-home"></span>首页</a>
		</li>
		<li class="active">
			<a href="http://c.biancheng.net/sitemap/" rel="nofollow"><span class="iconfont iconfont-book"></span>教程</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/vip/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-vip"></span>VIP会员</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/q2a/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-q2a"></span>一对一答疑</a>
		</li>
		<li>
			<a href="http://fudao.biancheng.net/" rel="nofollow" target="_blank"><span class="iconfont iconfont-fudao"></span>辅导班</a>
		</li>
	</ul>
</div>
<div id="header" class="clearfix">
	<a id="logo" class="left" href="http://c.biancheng.net/">
		<img height="26" src="./6.11Linux awk命令的高级玩法_files/logo.png" alt="C语言中文网">
	</a>
	<ul id="nav-main" class="hover-none left clearfix">
		<li class="wap-yes"><a href="http://c.biancheng.net/">首页</a></li>
		<li><a href="http://c.biancheng.net/c/">C语言教程</a></li>
		<li><a href="http://c.biancheng.net/cplus/">C++教程</a></li>
		<li><a href="http://c.biancheng.net/python/">Python教程</a></li>
		<li><a href="http://c.biancheng.net/java/">Java教程</a></li>
		<li><a href="http://c.biancheng.net/linux_tutorial/">Linux入门</a></li>
		<li><a href="http://c.biancheng.net/sitemap/" title="网站地图">更多&gt;&gt;</a></li>
	</ul>
	<span id="sidebar-toggle" class="toggle-btn" toggle-target="#sidebar">目录 <span class="glyphicon"></span></span>

	<a href="http://vip.biancheng.net/?from=topbar" class="user-info glyphicon glyphicon-user hover-none" target="_blank" rel="nofollow" title="用户中心"></a>
</div>
<div id="main" class="clearfix">
	<div id="sidebar" class="toggle-target">
	<div id="contents">
		<dt><span class="glyphicon glyphicon-option-vertical" aria-hidden="true"></span><a href="http://c.biancheng.net/linux_tutorial/">Linux</a></dt>
		
			<dd>
				<span class="channel-num">1</span>
				<a href="http://c.biancheng.net/linux_tutorial/10/">Linux简介</a>
			</dd>
		
			<dd>
				<span class="channel-num">2</span>
				<a href="http://c.biancheng.net/linux_tutorial/20/">Linux安装</a>
			</dd>
		
			<dd>
				<span class="channel-num">3</span>
				<a href="http://c.biancheng.net/linux_tutorial/file_content/">Linux文件和目录管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">4</span>
				<a href="http://c.biancheng.net/linux_tutorial/bale_compress/">Linux打包（归档）和压缩</a>
			</dd>
		
			<dd>
				<span class="channel-num">5</span>
				<a href="http://c.biancheng.net/linux_tutorial/40/">Vim文本编辑器</a>
			</dd>
		<dd class="this"> <span class="channel-num">6</span> <a href="http://c.biancheng.net/linux_tutorial/text_processing/">Linux文本处理（Linux三剑客）</a> </dd><dl class="dl-sub"><dd>6.1 <a href="http://c.biancheng.net/view/728.html">Linux连接合并文件内容(cat命令）</a></dd><dd>6.2 <a href="http://c.biancheng.net/view/729.html">Linux分屏显示文件内容（more命令）</a></dd><dd>6.3 <a href="http://c.biancheng.net/view/736.html">Linux显示文件开头内容（head命令）</a></dd><dd>6.4 <a href="http://c.biancheng.net/view/4004.html">Linux查看文件内容（less命令）</a></dd><dd>6.5 <a href="http://c.biancheng.net/view/737.html">Linux显示文件结尾内容（tail命令）</a></dd><dd>6.6 <a href="http://c.biancheng.net/view/vip_7660.html">Linux重定向（输入输出重定向）</a><span class="glyphicon glyphicon-usd"></span></dd><dd>6.7 <a href="http://c.biancheng.net/view/4017.html">Linux grep（Linux三剑客之一）</a></dd><dd>6.8 <a href="http://c.biancheng.net/view/4028.html">Linux sed（Linux三剑客之一）</a></dd><dd>6.9 <a href="http://c.biancheng.net/view/vip_5063.html">Linux sed命令的高级玩法</a><span class="glyphicon glyphicon-usd"></span></dd><dd>6.10 <a href="http://c.biancheng.net/view/4082.html">Linux awk（Linux三剑客之一）</a></dd><dd class="active">6.11 <a href="http://c.biancheng.net/view/vip_5064.html">Linux awk命令的高级玩法</a><span class="glyphicon glyphicon-usd"></span></dd></dl>
			<dd>
				<span class="channel-num">7</span>
				<a href="http://c.biancheng.net/linux_tutorial/50/">Linux软件安装</a>
			</dd>
		
			<dd>
				<span class="channel-num">8</span>
				<a href="http://c.biancheng.net/linux_tutorial/60/">Linux用户和用户组管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">9</span>
				<a href="http://c.biancheng.net/linux_tutorial/70/">Linux权限管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">10</span>
				<a href="http://c.biancheng.net/linux_tutorial/80/">Linux文件系统管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">11</span>
				<a href="http://c.biancheng.net/linux_tutorial/90/">Linux高级文件系统管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">12</span>
				<a href="http://c.biancheng.net/linux_tutorial/14/">Linux系统管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">13</span>
				<a href="http://c.biancheng.net/linux_tutorial/17/">Linux备份与恢复</a>
			</dd>
		
			<dd>
				<span class="channel-num">14</span>
				<a href="http://c.biancheng.net/linux_tutorial/13/">Linux系统服务管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">15</span>
				<a href="http://c.biancheng.net/linux_tutorial/15/">Linux系统日志管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">16</span>
				<a href="http://c.biancheng.net/linux_tutorial/12/">Linux启动管理</a>
			</dd>
		
			<dd>
				<span class="channel-num">17</span>
				<a href="http://c.biancheng.net/linux_tutorial/16/">LAMP环境搭建和LNMP环境搭建</a>
			</dd>
		
			<dd>
				<span class="channel-num">18</span>
				<a href="http://c.biancheng.net/linux_tutorial/18/">SELinux管理</a>
			</dd>
		
	</div>
</div>
	<div id="article-wrap">
		<div id="article">
			<div class="arc-info">
	<span class="position"><span class="glyphicon glyphicon-map-marker"></span> <a href="http://c.biancheng.net/">首页</a> &gt; <a href="http://c.biancheng.net/linux_tutorial/">Linux</a> &gt; <a href="http://c.biancheng.net/linux_tutorial/text_processing/">Linux文本处理（Linux三剑客）</a></span>
	<span class="read-num">阅读：8,692</span>
</div>

<div id="ad-position-bottom"></div>
			<h1>Linux awk命令的高级玩法</h1>
			<div class="pre-next-page clearfix">
                    <span class="pre left"><span class="icon">&lt;</span> <span class="text-brief text-brief-pre">上一页</span><a href="http://c.biancheng.net/view/4082.html">Linux awk（Linux三剑客之一）</a></span>
                    <span class="next right"><a href="http://c.biancheng.net/linux_tutorial/50/">Linux软件安装</a><span class="text-brief text-brief-next">下一页</span> <span class="icon">&gt;</span></span>
                </div>
			<div id="ad-arc-top"><p class="pic"></p><p class="text" adid="linuxprobe"><a href="http://fudao.biancheng.net/" rel="nofollow" target="_blank" style="color:#D33428;">C语言中文网推出辅导班啦，包括<span style="color: #008000;">「C语言辅导班、C++辅导班、算法/数据结构辅导班」</span>，全部都是一对一教学：一对一辅导 + 一对一答疑 + 布置作业 + 项目实践 + 永久学习。QQ在线，随时响应！</a></p></div>
			<div id="arc-body">前面一节已经介绍了 awk 的基本用法，其实在 awk 脚本程序中，还支持使用一些编程语言，比如变量、数组、分支结构（if-then-else）、循环结构（while）、函数等，下面一一给大家介绍。<br>
<h2>
	awk 使用变量</h2>
在 awk 的脚本程序中，支持使用变量来存取值。awk 支持两种不同类型的变量：
<ul>
	<li>
		内建变量：awk 本身就创建好，用户可以直接拿来用的变量，这些变量用来存放处理数据文件中的某些字段和记录的信息。</li>
	<li>
		自定义变量：awk 支持用户自己创建变量。</li>
</ul>
<h4>
	内建变量</h4>
awk 程序使用内建变量来引用程序数据里的一些特殊功能。常见的一些内建变量，包括上一节介绍的数据字段变量（$0、$1、$2...$n）以及表 1 、表 2 中所示的这些变量。<br>
<br>
<table>
	<caption>
		表 1 字段和记录分隔符变量</caption>
	<tbody>
		<tr>
			<th>
				变量</th>
			<th>
				功能</th>
		</tr>
		<tr>
			<td>
				FIELDWIDTHS</td>
			<td>
				由空格分隔的一列数字，定义了每个数据字段的确切宽度。</td>
		</tr>
		<tr>
			<td>
				FNR</td>
			<td>
				当前输入文档的记录编号，常在有多个输入文档时使用。</td>
		</tr>
		<tr>
			<td>
				NR</td>
			<td>
				输入流的当前记录编号。</td>
		</tr>
		<tr>
			<td>
				FS</td>
			<td>
				输入字段分隔符</td>
		</tr>
		<tr>
			<td>
				RS</td>
			<td>
				输入记录分隔符，默认为换行符 \n。</td>
		</tr>
		<tr>
			<td>
				OFS</td>
			<td>
				输出字段分隔符，默认为空格。</td>
		</tr>
		<tr>
			<td>
				ORS</td>
			<td>
				输出记录分隔符，默认为换行符 \n。</td>
		</tr>
	</tbody>
</table>
<br>
在表 1 中，变量 FS 和 OFS 定义了 awk 如何处理数据流中的数据字段。我们已经知道了如何使用变量 FS 来定义记录中的字段分隔符，变量 OFS 具备相同的功能，只不过是用在 print 命令的输出上，例如：<br>
<p class="info-box">
	[root@localhost ~]# cat data1<br>
	data11,data12,data13,data14,data15<br>
	data21,data22,data23,data24,data25<br>
	data31,data32,data33,data34,data35<br>
	[root@localhost ~]# awk 'BEGIN{FS=","; OFS="-"} {print $1,$2,$3}' data1<br>
	data11-data12-data13<br>
	data21-data22-data23<br>
	data31-data32-data33<br>
	[root@localhost ~]# awk 'BEGIN{FS=","; OFS="--"} {print $1,$2,$3}' data1<br>
	data11--data12--data13<br>
	data21--data22--data23<br>
	data31--data32--data33</p>
可以看到，print 命令会自动将 OFS 变量的值放置在输出中的每个字段间。通过设置 OFS 变量，可以在输出中使用任意字符串来分隔字段。<br>
<br>
FIELDWIDTHS 变量允许用户不依靠字段分隔符来读取记录。在一些应用程序中，数据并没有使用字段分隔符，而是被放置在了记录中的特定列，这种情况下，必须设定 FIELDWIDTHS 变量来匹配数据在记录中的位置。<br>
<br>
一旦设置了 FIELDWIDTH 变量，awk 就会忽略 FS 变量，并根据提供的字段宽度来计算字段，下面是个采用字段宽度而非字段分隔符的例子：
<p class="info-box">
	[root@localhost ~]# cat data1b<br>
	1005.3247596.37<br>
	115-2.349194.00<br>
	05810.1298100.1<br>
	[root@localhost ~]# awk 'BEGIN{FIELDWIDTHS="3 5 2 5"}{print $1,$2,$3,$4}' data1b<br>
	100 5.324 75 96.37<br>
	115 -2.34 91 94.00<br>
	058 10.12 98 100.1</p>
注意，一旦设定了 FIELDWIDTHS 变量的值，就不能再改变了，因此，这种方法并不适用于变长的字段。<br>
<br>
变量 RS 和 ORS 定义了 awk 程序如何处理数据流中的字段，默认情况下，awk 将 RS 和 ORS 设为换行符。默认的 RS 值表明，输入数据流中的每行新文本就是一条新纪录。 有时，你会在数据流中碰到占据多行的字段。典型的例子是包含地址和电话号码的数据，其中地址和电话号码各占一行，例如：
<p class="info-box">
	Riley Mullen<br>
	123 Main Street<br>
	Chicago, IL 60601<br>
	(312)555-1234</p>
如果你用默认的 FS 和 RS 变量值来读取这组数据，awk 就会把每行作为一条单独的记录来读取，并将记录中的空格当作字段分隔符，这并不是用户想要的。<br>
<br>
要解决这个问题，只需把 FS 变量设置成换行符，这就表明数据流中的每行都是一个单独的字段，每行上的所有数据都属于同一个字段；与此同时，把 RS 变量设置成空字符串，然后在数据记录间留一个空白行，awk 会把每个空白行当作一个记录分隔符。例如：<br>
<p class="info-box">
	[root@localhost ~]# cat data2<br>
	Riley Mullen<br>
	123 Main Street<br>
	Chicago, IL&nbsp; 60601<br>
	(312)555-1234<br>
	<br>
	Frank Williams<br>
	456 Oak Street<br>
	Indianapolis, IN&nbsp; 46201<br>
	(317)555-9876<br>
	<br>
	Haley Snell<br>
	4231 Elm Street<br>
	Detroit, MI 48201<br>
	(313)555-4938<br>
	[root@localhost ~]# awk 'BEGIN{FS="\n"; RS=""} {print $1,$4}' data2<br>
	Riley Mullen (312)555-1234<br>
	Frank Williams (317)555-9876<br>
	Haley Snell (313)555-4938</p>
<br>
<table>
	<caption>
		表 2 环境信息变量</caption>
	<tbody>
		<tr>
			<th>
				变量名</th>
			<th>
				功能</th>
		</tr>
		<tr>
			<td>
				ARGC</td>
			<td>
				命令行参数个数。</td>
		</tr>
		<tr>
			<td>
				ARGIND</td>
			<td>
				当前文件在 ARGC 中的位置。</td>
		</tr>
		<tr>
			<td>
				ARGV</td>
			<td>
				包含命令行参数的数组。</td>
		</tr>
		<tr>
			<td>
				CONVFMT</td>
			<td>
				数字的转换格式，默认值为 %.6g。</td>
		</tr>
		<tr>
			<td>
				ENVIRON</td>
			<td>
				当前 shell 环境变量及其值组成的关联数组。</td>
		</tr>
		<tr>
			<td>
				ERRNO</td>
			<td>
				当读取或关闭输入文件发生错误时的系统错误号。</td>
		</tr>
		<tr>
			<td>
				FILENAME</td>
			<td>
				当前输入文档的名称。</td>
		</tr>
		<tr>
			<td>
				FNR</td>
			<td>
				当前数据文件中的数据行数。</td>
		</tr>
		<tr>
			<td>
				IGNORECASE</td>
			<td>
				设成非 0 值时，忽略 awk 命令中出现的字符串的字符大小写。</td>
		</tr>
		<tr>
			<td>
				NF</td>
			<td>
				数据文件中的字段总数。</td>
		</tr>
		<tr>
			<td>
				NR</td>
			<td>
				已处理的输入记录数。</td>
		</tr>
		<tr>
			<td>
				OFMT</td>
			<td>
				数字的输出格式，默认值为 %.6g。</td>
		</tr>
		<tr>
			<td>
				RLENGTH</td>
			<td>
				由 match 函数所匹配的子字符串的长度。</td>
		</tr>
		<tr>
			<td>
				TSTART</td>
			<td>
				由 match 函数所匹配的子字符串的起始位置。</td>
		</tr>
	</tbody>
</table>
<br>
其中，FNR 和 NR 变量虽然类似，但又略有不同。FNR 变量含有当前数据文件中已处理过的记录数，NR 变量则含有已处理过的记录总数。举个例子：<br>
<p class="info-box">
	[root@localhost ~]# cat data1<br>
	data11,data12,data13,data14,data15<br>
	data21,data22,data23,data24,data25<br>
	data31,data32,data33,data34,data35<br>
	[root@localhost ~]# awk '<br>
	&gt; BEGIN {FS=","}<br>
	&gt; {print $1,"FNR="FNR,"NR="NR}<br>
	&gt; END{print "There were",NR,"records processed"}' data1 data1<br>
	data11 FNR=1 NR=1<br>
	data21 FNR=2 NR=2<br>
	data31 FNR=3 NR=3<br>
	data11 FNR=1 NR=4<br>
	data21 FNR=2 NR=5<br>
	data31 FNR=3 NR=6<br>
	There were 6 records processed</p>
由此可以看出，当只使用一个数据文件作为输入时，FNR 和 NR 的值是相同的；如果使用多个数据文件作为输入，FNR 的值会在处理每个数据文件时被重置，而 NR 的值则会继续计数直到处理完所有的数据文件。<br>
<h4>
	自定义变量</h4>
和其他典型的编程语言一样，awk 允许用户定义自己的变量在脚本程序中使用。awk 自定义变量名可以是任意数目的字母、数字和下划线，但不能以数字开头。更重要的是，awk 变量名区分大小写。<br>
<br>
举个简单的例子：
<p class="info-box">
	[root@localhost ~]# awk '<br>
	&gt; BEGIN{<br>
	&gt; testing="This is a test"<br>
	&gt; print testing<br>
	&gt; testing=45<br>
	&gt; print testing<br>
	&gt; }'<br>
	This is a test<br>
	45</p>
可以看到，print 语句的输出是 testing 变量的当前值。<br>
<br>
也可以用 awk 命令行来给程序中的变量赋值，这允许我们在正常的代码之外赋值，即时改变变量的值，比如：<br>
<p class="info-box">
	[root@localhost ~]# cat script1<br>
	BEGIN{FS=","} {print $n}<br>
	[root@localhost ~]# awk -f script1 n=2 data1<br>
	data12<br>
	data22<br>
	data32<br>
	[root@localhost ~]# awk -f script1 n=3 data1<br>
	data13<br>
	data23<br>
	data33</p>
需要注意的是，使用命令行参数来定义变量值会有一个问题，即设置了变量后，这个值在代码的 BEGIN 部分不可用，如下所示：
<p class="info-box">
	[root@localhost ~]# cat script2<br>
	BEGIN{print "The starting value is",n; FS=","}<br>
	{print $n}<br>
	[root@localhost ~]# awk -f script2 n=3 data1<br>
	The starting value is<br>
	data13<br>
	data23<br>
	data33</p>
解决这个问题，可以用 -v 命令行参数，它可以实现在 BEGIN 代码之前设定变量。在命令行上，-v 命令行参数必须放在脚本代码之前，如下所示：
<p class="info-box">
	[root@localhost ~]# awk -v n=3 -f script2 data1<br>
	The starting value is 3<br>
	data13<br>
	data23<br>
	data33</p>
注意，awk 脚本程序中输出函数还可以使用 C 语言中的 printf 函数，具体用法可阅读《<a href="http://c.biancheng.net/view/1757.html" target="_blank">C语言 printf 函数</a>》 和《<a href="http://c.biancheng.net/view/1793.html" target="_blank">C语言输出大汇总</a>》两篇文章，系统学习此函数的用法。
<h2>
	awk 使用数组</h2>
为了在单个变量中存储多个值，许多编程语言都提供数组，awk 使用关联数组提供数组功能。<br>
<br>
关联数组跟数字数组不同之处在于，它的索引值可以是任意文本字符串。用户不需要用连续的数字来标识数组中的数据元素；相反，关联数组用各种字符串来引用值。每个索引字符串都必须能够唯一地标识出赋给它的数据元素。<br>
<p class="info-box">
	如果你熟悉其他编程语言的话，其实关联数组和散列表、字典的用法类似。</p>
<h4>
	关联数组的定义和使用</h4>
在 awk 脚本程序中，定义一个数组变量可以使用标准复制语句，其基本格式为：
<p class="info-box">
	var[index]=element</p>
其中，var 是数组名，index 是关联数组的索引值，element 是数据元素值。例如：
<p class="info-box">
	capital["Illinois"] = "Springfield"<br>
	capital["Indiana"] = "Indianapolis"<br>
	capital["Ohio"] = "Columbus"</p>
在引用数组变量时，必须用索引值（index）来提取相应的数据元素值，例如：<br>
<p class="info-box">
	[root@localhost ~]# awk 'BEGIN{<br>
	&gt; capital["Illinois"] = "Springfield"<br>
	&gt; print capital["Illinois"]<br>
	&gt; }'<br>
	Springfield</p>
数组变量也是变量，也可以使用其进行基本的算术运算，例如：
<p class="info-box">
	[root@localhost ~]# awk 'BEGIN{<br>
	&gt; var[1] = 34<br>
	&gt; var[2] = 3<br>
	&gt; total = var[1] + var[2]<br>
	&gt; print total<br>
	&gt; }'<br>
	37</p>
<h4>
	关联数组的遍历</h4>
在 awk 中遍历关联数组，可以用 for 语句的一种特殊形式：
<p class="info-box">
	for (var in array)<br>
	{<br>
	&nbsp;&nbsp;&nbsp; statements<br>
	}</p>
这个 for 语句会在每次循环时将关联数组 array 的下一个索引值赋给变量 var，然后执行一遍 statements。<br>
<p class="info-box">
	再次强调，整个遍历过程中，传给 var 的都是每个数组元素的索引值（也就是 index），不是数组元素的值。</p>
举个例子：<br>
<p class="info-box">
	[root@localhost ~]# awk 'BEGIN{<br>
	&gt; var["a"] = 1<br>
	&gt; var["g"] = 2<br>
	&gt; var["m"] = 3<br>
	&gt; var["u"] = 4<br>
	&gt; for (test in var)<br>
	&gt; {<br>
	&gt;&nbsp;&nbsp;&nbsp; print "Index:",test," - Value:",var[test]<br>
	&gt; }<br>
	&gt; }'<br>
	Index: u&nbsp; - Value: 4<br>
	Index: m&nbsp; - Value: 3<br>
	Index: a&nbsp; - Value: 1<br>
	Index: g&nbsp; - Value: 2</p>
注意，索引值不会按任何特定顺序返回，但它们都能够指向对应的数据元素值。<br>
<h4>
	删除数组变量</h4>
awk脚本程序还支持从关联数组中删除某个数组索引，使用 delete 命令就可以，此命令会从数组中删除指定的索引值及相关的数据元素的值。<br>
<br>
delete 命令的基本格式如下：
<p class="info-box">
	delete array[index]</p>
举个例子：
<p class="info-box">
	[root@localhost ~]# awk 'BEGIN{<br>
	&gt; var["a"] = 1<br>
	&gt; var["g"] = 2<br>
	&gt; for (test in var)<br>
	&gt; {<br>
	&gt;&nbsp;&nbsp;&nbsp; print "Index:",test," - Value:",var[test]<br>
	&gt; }<br>
	&gt; delete var["g"]<br>
	&gt; print "---"<br>
	&gt; for (test in var)<br>
	&gt; {<br>
	&gt;&nbsp;&nbsp;&nbsp; print "Index:",test," - Value:",var[test]<br>
	&gt; }<br>
	&gt; }'<br>
	Index: a&nbsp; - Value: 1<br>
	Index: g&nbsp; - Value: 2<br>
	---<br>
	Index: a&nbsp; - Value: 1</p>
需要注意的是，一旦从关联数组中删除了索引值，就没法再用它来提取元素值。<br>
<h2>
	awk使用分支结构</h2>
awk 支持标准的 if-then-else 格式的 if 语句，其基本格式为：<br>
<p class="info-box">
	if (condition)<br>
	&nbsp;&nbsp;&nbsp; statement1<br>
	else<br>
	&nbsp;&nbsp;&nbsp; statements</p>
也可以将它放在一行上，像这样：
<p class="info-box">
	if (condition) statement1；else statement2</p>
举个简单的例子：
<p class="info-box">
	[root@localhost ~]# cat data4<br>
	10<br>
	5<br>
	13<br>
	50<br>
	34<br>
	[root@localhost ~]# awk '{if ($1 &gt; 20) print $1 * 2; else print $1 / 2}' data4<br>
	5<br>
	2.5<br>
	6.5<br>
	100<br>
	68</p>
<h2>
	awk使用循环结构</h2>
awk 脚本程序中，可以使用 while、do-while、for 这 3 种循环结构，它们各自的基本格式分别如表 3 所示。<br>
<br>
<table>
	<caption>
		表 3 循环结构基本格式及实例</caption>
	<tbody>
		<tr>
			<th>
				基本格式</th>
			<th>
				实例</th>
		</tr>
		<tr>
			<td>
				while (条件) {<br>
				&nbsp;&nbsp; 运行代码；<br>
				}</td>
			<td>
				<p class="info-box">
					[root@localhost ~]# cat data5<br>
					130 120 135<br>
					160 113 140<br>
					145 170 215<br>
					[root@localhost ~]# awk '{<br>
					&gt; total = 0<br>
					&gt; i = 1<br>
					&gt; while (i &lt; 4)<br>
					&gt; {<br>
					&gt;&nbsp;&nbsp;&nbsp; total += $i<br>
					&gt;&nbsp;&nbsp;&nbsp; i++<br>
					&gt; }<br>
					&gt; avg = total / 3<br>
					&gt; print "Average:",avg<br>
					&gt; }' data5<br>
					Average: 128.333<br>
					Average: 137.667<br>
					Average: 176.667</p>
			</td>
		</tr>
		<tr>
			<td>
				do<br>
				{<br>
				运行代码；<br>
				}while(条件)</td>
			<td>
				<p class="info-box">
					[root@localhost ~]# awk '{<br>
					&gt; total = 0<br>
					&gt; i = 1<br>
					&gt; do<br>
					&gt; {<br>
					&gt;&nbsp;&nbsp;&nbsp; total += $i<br>
					&gt;&nbsp;&nbsp;&nbsp; i++<br>
					&gt; } while (total &lt; 150)<br>
					&gt; print total }' data5<br>
					250<br>
					160<br>
					315</p>
			</td>
		</tr>
		<tr>
			<td>
				for(变量；条件；计数器)<br>
				{<br>
				&nbsp;&nbsp;&nbsp; 运行代码；<br>
				}</td>
			<td>
				<p class="info-box">
					[root@localhost ~]# awk '{<br>
					&gt; total = 0<br>
					&gt; for (i = 1; i &lt; 4; i++)<br>
					&gt; {<br>
					&gt;&nbsp;&nbsp;&nbsp; total += $i<br>
					&gt; }<br>
					&gt; avg = total / 3<br>
					&gt; print "Average:",avg<br>
					&gt; }' data5<br>
					Average: 128.333<br>
					Average: 137.667<br>
					Average: 176.667</p>
			</td>
		</tr>
	</tbody>
</table>
<br>
从表 3 中可以看出，awk 支持使用的循环结构的用法和 C 语言完全一样，除此之外，awk 还支持使用 break（跳出循环）、continue（终止当前循环）关键字，其用法和 C 语言中也完全相同，这里不再过多赘述，读者可以阅读《<a href="http://c.biancheng.net/c/32/" target="_blank">C语言循环结构和选择结构</a>》一章系统学习。<br>
<h2>
	awk使用函数</h2>
<h4>
	内建函数</h4>
和内建变量类似，awk 也提供了不少内建函数，可进行一些常见的数学、字符串以及时间函数运算，如表 4 所示。<br>
<br>
<table>
	<caption>
		表 4 awk 内建函数</caption>
	<tbody>
		<tr>
			<th>
				函数分类</th>
			<th>
				函数原型</th>
			<th>
				函数功能</th>
		</tr>
		<tr>
			<th colspan="1" rowspan="9">
				数学函数</th>
			<td>
				atan2(x, y)</td>
			<td>
				x/y 的反正切，x 和 y 以弧度为单位。</td>
		</tr>
		<tr>
			<td>
				cos(x)</td>
			<td>
				x 的余弦，x 以弧度为单位。</td>
		</tr>
		<tr>
			<td>
				exp(x)</td>
			<td>
				x 的指数函数。</td>
		</tr>
		<tr>
			<td>
				int(x)</td>
			<td>
				x 的整数部分，取靠近零一侧的值。</td>
		</tr>
		<tr>
			<td>
				log(x)</td>
			<td>
				x 的自然对数。</td>
		</tr>
		<tr>
			<td>
				srand(x)</td>
			<td>
				为计算随机数指定一个种子值。</td>
		</tr>
		<tr>
			<td>
				rand()</td>
			<td>
				比 0 大比 1 小的随机浮点值。</td>
		</tr>
		<tr>
			<td>
				sin(x)</td>
			<td>
				x 的正弦，x 以弧度为单位。</td>
		</tr>
		<tr>
			<td>
				sqrt(x)</td>
			<td>
				x 的平方根。</td>
		</tr>
		<tr>
			<th colspan="1" rowspan="6">
				位运算函数</th>
			<td>
				and(v1, v2)</td>
			<td>
				执行值 v1 和 v2 的按位与运算。</td>
		</tr>
		<tr>
			<td>
				compl(val)</td>
			<td>
				执行 val 的补运算。</td>
		</tr>
		<tr>
			<td>
				lshift(val, count)</td>
			<td>
				将值 val 左移 count 位。</td>
		</tr>
		<tr>
			<td>
				or(v1, v2)</td>
			<td>
				执行值 v1 和 v2 的按位或运算。</td>
		</tr>
		<tr>
			<td>
				rshift(val, count)</td>
			<td>
				将值 val 右移 count 位。</td>
		</tr>
		<tr>
			<td>
				xor(v1, v2)</td>
			<td>
				执行值 v1 和 v2 的按位异或运算。</td>
		</tr>
		<tr>
			<th colspan="1" rowspan="13">
				字符串函数</th>
			<td>
				asort(s [,d])</td>
			<td>
				将数组 s 按数据元素值排序。索引值会被替换成表示新的排序顺序的连续数字。另外，如果指定了 d，则排序后的数组会存储在数组 d 中。</td>
		</tr>
		<tr>
			<td>
				asorti(s [,d])</td>
			<td>
				将数组 s 按索引值排序。生成的数组会将索引值作为数据元素值，用连续数字索引来表明排序顺序。另外如果指定了 d，排序后的数组会存储在数组 d 中。</td>
		</tr>
		<tr>
			<td>
				gensub(r, s, h [, t])&nbsp;</td>
			<td>
				查找变量 $0 或目标字符串 t（如果提供了的话）来匹配正则表达式 r。如果 h 是一个以 g 或 G 开头的字符串，就用 s 替换掉匹配的文本。如果 h 是一个数字，它表示要替换掉第 h 处 r 匹配的地方。</td>
		</tr>
		<tr>
			<td>
				gsub(r, s [,t])</td>
			<td>
				查找变量 $0 或目标字符串 t（如果提供了的话）来匹配正则表达式 r。如果找到了，就全部替换成字符串 s。</td>
		</tr>
		<tr>
			<td>
				index(s, t)</td>
			<td>
				返回字符串 t 在字符串 s 中的索引值，如果没找到的话返回 0。</td>
		</tr>
		<tr>
			<td>
				length([s])</td>
			<td>
				返回字符串 s 的长度；如果没有指定的话，返回 $0 的长度。</td>
		</tr>
		<tr>
			<td>
				match(s, r [,a])</td>
			<td>
				返回字符串 s 中正则表达式 r 出现位置的索引。如果指定了数组 a，它会存储 s 中匹配正则表达式的那部分。</td>
		</tr>
		<tr>
			<td>
				split(s, a [,r])</td>
			<td>
				将 s 用 FS 字符或正则表达式 r（如果指定了的话）分开放到数组 a 中，并返回字段的总数。</td>
		</tr>
		<tr>
			<td>
				sprintf(format, variables)</td>
			<td>
				用提供的 format 和 variables 返回一个类似于 printf 输出的字符串。</td>
		</tr>
		<tr>
			<td>
				sub(r, s [,t])&nbsp;</td>
			<td>
				在变量 $0 或目标字符串 t 中查找正则表达式 r 的匹配。如果找到了，就用字符串 s 替换掉第一处匹配。</td>
		</tr>
		<tr>
			<td>
				substr(s, i [,n])</td>
			<td>
				返回 s 中从索引值 i 开始的 n 个字符组成的子字符串。如果未提供 n，则返回 s 剩下的部分。</td>
		</tr>
		<tr>
			<td>
				tolower(s)</td>
			<td>
				将 s 中的所有字符转换成小写。</td>
		</tr>
		<tr>
			<td>
				toupper(s)</td>
			<td>
				将 s 中的所有字符转换成大写。</td>
		</tr>
		<tr>
			<th colspan="1" rowspan="3">
				时间函数</th>
			<td>
				mktime(datespec)</td>
			<td>
				将一个按 YYYY MM DD HH MM SS [DST] 格式指定的日期转换成时间戳值。</td>
		</tr>
		<tr>
			<td>
				strftime(format [,timestamp])</td>
			<td>
				将当前时间的时间戳或 timestamp（如果提供了的话）转化格式化日期（采用 shell 函数 date() 的格式）。</td>
		</tr>
		<tr>
			<td>
				systime()</td>
			<td>
				返回当前时间的时间戳。</td>
		</tr>
	</tbody>
</table>
<p class="info-box">
	时间戳指的是格林威治时间，即从 1970年1月1日8时1起到现在的总秒数。</p>
<h4>
	自定义函数</h4>
除了awk 中的内建函数，还可以在 awk 脚本程序中自定义函数，创建自定义函数的基本格式为：
<p class="info-box">
	function 函数名(参数1，参数2，...)<br>
	{<br>
	&nbsp;&nbsp;&nbsp; 运行代码；<br>
	}</p>
注意，自定义函数的函数名必须能够唯一标识此函数，换句话说，在同一个 awk 脚本程序中，多个函数的函数名不能相同。同时，函数的参数可以有多个（0 个、1 个或多个）。<br>
<br>
例如：
<p class="info-box">
	function printthird()<br>
	{<br>
	&nbsp;&nbsp;&nbsp; print $3<br>
	}</p>
此函数会打印记录中的第三个数据字段。<br>
<br>
函数还能用 return 语句返回值，例如：
<p class="info-box">
	function myrand(limit) {<br>
	&nbsp;&nbsp;&nbsp; return int(limit * rand())<br>
	}</p>
需要注意的是，在定义函数时，它必须出现在所有代码块之前（包括 BEGIN 和 END代码块）。<br>
<h4>
	创建函数库</h4>
awk 提供了一种途径来将多个函数放到一个库文件中，这样用户就能在所有的 awk 脚本程序中使用了。为了方便大家理解，下面给大家举个实例。<br>
<br>
首先，我们需要创建一个存储所有 awk 函数的文件：
<p class="info-box">
	[root@localhost ~]# cat funclib<br>
	function myprint() {<br>
	&nbsp;&nbsp; printf "%-16s - %s\n", $1, $4<br>
	}<br>
	function myrand(limit)<br>
	{<br>
	&nbsp;&nbsp; return int(limit * rand())<br>
	}<br>
	function printthird()<br>
	{<br>
	&nbsp;&nbsp; print $3<br>
	}</p>
要想让 awk 成功读取 funclib 函数库文件，就需要使用 -f 选项，但此选项无法和 awk 脚本程序同时放到命令行中一起使用。因此，要使用库函数文件，只能再创建一个脚本程序文件，例如：<br>
<p class="info-box">
	[root@localhost ~]# cat script4<br>
	BEGIN{ FS="\n"; RS=""}<br>
	{<br>
	&nbsp;&nbsp;&nbsp;&nbsp; myprint()<br>
	}<br>
	[root@localhost ~]# awk -f funclib -f script4 data2<br>
	Riley Mullen&nbsp;&nbsp;&nbsp;&nbsp; - (312)555-1234<br>
	Frank Williams&nbsp;&nbsp; - (317)555-9876<br>
	Haley Snell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - (313)555-4938</p>
</div>
			<div id="arc-append">
	<p>关注微信公众号「站长严长生」，在手机上阅读所有教程，随时随地都能学习。本公众号由<a class="col-link" href="http://c.biancheng.net/view/8092.html" target="_blank" rel="nofollow">C语言中文网站长</a>运营，每日更新，坚持原创，敢说真话，凡事有态度。</p>
	<p style="margin-top:12px; text-align:center;">
		<img width="180" src="./6.11Linux awk命令的高级玩法_files/qrcode_weixueyuan_original.png" alt="魏雪原二维码"><br>
		<span class="col-green">微信扫描二维码关注公众号</span>
	</p>
</div>
<!-- <p>关注微信公众号「魏雪原」，跟着<a class="col-link" href="/view/8092.html" target="_blank">站长</a>一起学习，拒绝躺平，跳出内卷，用知识完成阶级跃升：</p>
	<ul>
		<li>每日更新，坚持原创，敢说真话，凡事有态度。</li>
		<li>编程+求职+创业+营销，既有硬知识，也有软技能。</li>
		<li>手机端阅读教程，随时随地都能学习。</li>
		<li>即将绑定网站部分功能，包括注册登录、找回密码、获取下载链接等。</li>
	</ul> -->
			<div class="pre-next-page clearfix">
                    <span class="pre left"><span class="icon">&lt;</span> <span class="text-brief text-brief-pre">上一页</span><a href="http://c.biancheng.net/view/4082.html">Linux awk（Linux三剑客之一）</a></span>
                    <span class="next right"><a href="http://c.biancheng.net/linux_tutorial/50/">Linux软件安装</a><span class="text-brief text-brief-next">下一页</span> <span class="icon">&gt;</span></span>
                </div>
			<div id="ad-arc-bottom"></div>

<!-- <div id="ad-bottom-weixin" class="clearfix">
	<div class="left" style="width: 535px;">
		<p><span class="col-red">编程帮</span>，一个分享编程知识的公众号。跟着<a class="col-link" href="/cpp/about/author/" target="_blank">站长</a>一起学习，每天都有进步。</p>
		<p>通俗易懂，深入浅出，一篇文章只讲一个知识点。</p>
		<p>文章不深奥，不需要钻研，在公交、在地铁、在厕所都可以阅读，随时随地涨姿势。</p>
		<p>文章不涉及代码，不烧脑细胞，人人都可以学习。</p>
		<p>当你决定关注「编程帮」，你已然超越了90%的程序员！</p>
	</div>
	<div class="right" style="width: 150px;">
		<img width="150" src="/templets/new/images/erweima_biancheng.gif?v=1.6.72" alt="编程帮二维码" /><br />
		<span class="col-green">微信扫描二维码关注</span>
	</div>
</div> -->

<div id="nice-arcs" class="box-bottom">
	<h4>优秀文章</h4>
	<ul class="clearfix">
<li><a href="http://c.biancheng.net/view/68.html" title="Go语言构造函数">Go语言构造函数</a></li>
<li><a href="http://c.biancheng.net/view/626.html" title="vi按字移动光标命令">vi按字移动光标命令</a></li>
<li><a href="http://c.biancheng.net/view/vip_1722.html" title="C语言和C++到底有什么关系？">C语言和C++到底有什么关系？</a></li>
<li><a href="http://c.biancheng.net/view/2171.html" title="Python变量的定义和使用">Python变量的定义和使用</a></li>
<li><a href="http://c.biancheng.net/view/5494.html" title="如何创建Python程序包，Python程序包结构详解（超级详细）">如何创建Python程序包，Python程序包结构详解（超级详细）</a></li>
<li><a href="http://c.biancheng.net/view/6408.html" title="traceroute命令进行路由跟踪">traceroute命令进行路由跟踪</a></li>
<li><a href="http://c.biancheng.net/view/vip_7065.html" title="Java static的常见问题和使用误区">Java static的常见问题和使用误区</a></li>
<li><a href="http://c.biancheng.net/maven2/dependency.html" title="Maven依赖">Maven依赖</a></li>
<li><a href="http://c.biancheng.net/view/9345.html" title="JS for循环语句的用法">JS for循环语句的用法</a></li>
<li><a href="http://c.biancheng.net/view/9370.html" title="JS表单验证（附带示例）">JS表单验证（附带示例）</a></li>
</ul>
</div>
		</div>
		
	</div>
</div>
<script type="text/javascript">
// 当前文章ID
window.arcIdRaw = 'a_' + 5064;
window.arcId = "a245roOhyPnCz3DjidPCr9SLDZOD819oPEugjMEtdpwbDJdsXryBo/BMDm8";
window.typeidChain = "290|77";
</script>
<div id="footer" class="clearfix">
	<div class="info left">
	<p>精美而实用的网站，分享优质编程教程，帮助有志青年。千锤百炼，只为大作；精益求精，处处斟酌；这种教程，看一眼就倾心。</p>
	<p>
		<a href="http://c.biancheng.net/view/8066.html" target="_blank" rel="nofollow">关于网站</a> <span>|</span>
		<a href="http://c.biancheng.net/view/8092.html" target="_blank" rel="nofollow">关于站长</a> <span>|</span>
		<a href="http://c.biancheng.net/view/8097.html" target="_blank" rel="nofollow">如何完成一部教程</a> <span>|</span>
		<a href="http://c.biancheng.net/view/8093.html" target="_blank" rel="nofollow">联系我们</a> <span>|</span>
		<a href="http://c.biancheng.net/sitemap/" target="_blank" rel="nofollow">网站地图</a>
	</p>
	<p>Copyright ©2012-2021 biancheng.net, <a href="http://www.beian.miit.gov.cn/" target="_blank" rel="nofollow" style="color:#666;">陕ICP备15000209号</a></p>
	</div>
	<img class="right" src="./6.11Linux awk命令的高级玩法_files/logo_bottom.gif" alt="底部Logo">
	<span id="return-top"><b>↑</b></span>
</div>

<script type="text/javascript">
window.siteId = 4;
window.cmsTemplets = "/templets/new";
window.cmsTempletsVer = "1.6.72";
</script>

<script src="./6.11Linux awk命令的高级玩法_files/jquery1.12.4.min.js.下载"></script>
<script src="./6.11Linux awk命令的高级玩法_files/common.js.下载"></script>
<span style="display:none;"><script src="./6.11Linux awk命令的高级玩法_files/z_stat.php" type="text/javascript" defer="defer" async="async"></script></span>

</body></html>